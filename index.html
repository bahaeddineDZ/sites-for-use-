<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“š Ù…ÙƒØªØ¨ØªÙŠ Ù„Ù„Ù…ÙˆØ§Ù‚Ø¹ - Ø¨Ù‡Ø§Ø¡</title>
<style>
:root{
  --primary:#2c3e50;
  --accent:#2980b9;
  --danger:#e74c3c;
  --muted:#7f8c8d;
  --card:#ffffff;
}
*{box-sizing:border-box}
body{font-family:Tahoma,Arial,sans-serif;background:linear-gradient(180deg,#eef6fb,#f4f6f9);margin:0;padding:0;min-height:100vh;display:flex;flex-direction:column}
header{background:var(--primary);color:#fff;padding:14px 18px;display:flex;gap:12px;align-items:center;justify-content:space-between}
header h1{font-size:18px;margin:0}
.user-area{display:flex;align-items:center;gap:10px}
.user-pic{width:36px;height:36px;border-radius:50%;object-fit:cover;border:2px solid rgba(255,255,255,0.2)}
.btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
.btn.secondary{background:#fff;color:var(--accent);border:1px solid rgba(0,0,0,0.06)}
.layout{display:flex;gap:18px;padding:18px;flex:1;align-items:flex-start}
.board{flex:1;min-width:320px;position:relative}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px}
.controls input{padding:10px;border-radius:10px;border:1px solid #d0d7de;font-size:14px;flex:1;min-width:140px}
.controls .add-btn{background:var(--accent);padding:10px 16px;border-radius:10px;color:#fff;border:none;cursor:pointer}
#siteList{position:relative;min-height:420px;border-radius:12px;padding:12px;background:transparent}
.card{position:absolute;width:200px;height:250px;border-radius:12px;box-shadow:0 8px 18px rgba(0,0,0,0.12);overflow:hidden;background:var(--card);transition:transform .15s}
.card:hover{transform:translateY(-6px)}
.card img{width:100%;height:100%;object-fit:cover;display:block;cursor:pointer}
.card-content{position:absolute;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);color:#fff;padding:8px;text-align:center}
.card-content div{margin:2px 0}
.card .drag-handle{position:absolute;top:6px;right:6px;width:22px;height:22px;background:var(--accent);border-radius:6px;cursor:move}
.card .resize-handle{position:absolute;left:6px;bottom:6px;width:16px;height:16px;background:#2ecc71;clip-path:polygon(0 100%,100% 100%,0 0);cursor:nwse-resize}
.card .actions button{margin:2px;padding:6px 8px;border-radius:8px;border:none;cursor:pointer}
.card .actions .delete{background:var(--danger);color:#fff}
.card .actions .edit{background:#f39c12;color:#fff}
.side{width:360px;max-width:40vw;display:flex;flex-direction:column;gap:12px}
.list-panel{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 6px 14px rgba(0,0,0,0.06);min-height:180px}
.list-panel h3{margin:0 0 8px 0;font-size:16px;color:var(--primary)}
.sites-list-short{display:flex;flex-direction:column;gap:8px;max-height:160px;overflow:auto}
.site-item{display:flex;gap:8px;align-items:center}
.site-item img{width:48px;height:36px;object-fit:cover;border-radius:6px}
.site-item a{color:var(--accent);text-decoration:none;display:block}
.chat-panel{display:flex;flex-direction:column;gap:8px;background:var(--card);padding:12px;border-radius:12px;box-shadow:0 6px 14px rgba(0,0,0,0.06)}
#chatBox{height:260px;overflow:auto;border-radius:8px;padding:8px;background:#fbfdff;border:1px solid #eef5fb}
.msg{padding:8px;border-radius:15px;margin-bottom:8px;max-width:70%;word-wrap:break-word;clear:both}
.msg.me{background:#2980b9;color:white;float:right;border-bottom-right-radius:0}
.msg.other{background:#e0e0e0;color:black;float:left;border-bottom-left-radius:0}
.chat-controls{display:flex;gap:8px;margin-top:6px}
.chat-controls input{flex:1;padding:10px;border-radius:8px;border:1px solid #dceaf7}
.chat-controls button{padding:8px 12px;border:none;border-radius:6px;background:#2980b9;color:white;cursor:pointer}
.chat-controls button:hover{background:#1f5f87}
.emoji-panel{display:none;background:white;border:1px solid #ccc;border-radius:10px;padding:10px;margin-top:5px;max-height:120px;overflow-y:auto}
.emoji-panel span{cursor:pointer;font-size:20px;margin:5px}
#chatHint{margin-top:8px;font-size:12px;color:gray;text-align:center}
footer{padding:10px;text-align:center;color:var(--muted);font-size:13px}
@media(max-width:900px){.layout{flex-direction:column}.side{width:100%}}
</style>
</head>
<body>
<header>
  <h1>ğŸ“š Ù…ÙƒØªØ¨ØªÙŠ Ù„Ù„Ù…ÙˆØ§Ù‚Ø¹ - Ø¨Ù‡Ø§Ø¡</h1>
  <div class="user-area" id="userArea">
    <img id="userPic" class="user-pic" src="" alt="" style="display:none">
    <div id="userName" class="small" style="display:none"></div>
    <button id="loginBtn" class="btn">ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    <button id="logoutBtn" class="btn secondary" style="display:none">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </div>
</header>

<div class="layout">
  <div class="board">
    <div class="controls">
      <input id="siteName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹">
      <input id="siteUrl" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ (https://)">
      <input id="siteImage" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
      <button id="addBtn" class="add-btn">â• Ø¥Ø¶Ø§ÙØ©</button>
    </div>
    <div id="siteList" aria-live="polite"></div>
  </div>

  <div class="side">
    <div class="list-panel">
      <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹</h3>
      <div class="sites-list-short" id="sitesShort"></div>
    </div>

    <div class="chat-panel">
      <h3>Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø­ÙŠØ©</h3>
      <div id="chatBox"></div>
      <div class="chat-controls">
        <input id="chatMessage" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...">
        <button type="button" onclick="toggleEmojiPanel()">ğŸ˜Š</button>
        <button id="sendMsgBtn">ğŸ“¨</button>
      </div>
      <div id="emojiPanel" class="emoji-panel"></div>
      <div id="chatHint" class="small">Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ØªØ³ØªØ·ÙŠØ¹ Ø§Ù„ÙƒØªØ§Ø¨Ø©.</div>
    </div>
  </div>
</div>

<footer>Â© Ù…ÙƒØªØ¨ØªÙŠ Ù„Ù„Ù…ÙˆØ§Ù‚Ø¹ â€” BBE</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, doc, updateDoc, deleteDoc, onSnapshot, query, orderBy, serverTimestamp, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAMJkL6Fvv9kzgWtHz7ccp79H80EhLogqk",
  authDomain: "site-for-use.firebaseapp.com",
  projectId: "site-for-use",
  storageBucket: "site-for-use.appspot.com",
  messagingSenderId: "44820921915",
  appId: "1:44820921915:web:27ff432c93b013e7a2a61e",
  measurementId: "G-LRLK1DGEX7"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

// DOM
const addBtn = document.getElementById("addBtn");
const siteList = document.getElementById("siteList");
const sitesShort = document.getElementById("sitesShort");
const siteNameInput = document.getElementById("siteName");
const siteUrlInput = document.getElementById("siteUrl");
const siteImageInput = document.getElementById("siteImage");

const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const userPic = document.getElementById("userPic");
const userNameEl = document.getElementById("userName");

const chatBox = document.getElementById("chatBox");
const chatInput = document.getElementById("chatMessage");
const sendMsgBtn = document.getElementById("sendMsgBtn");
const chatHint = document.getElementById("chatHint");

let currentUser = null;
let editId = null;

// Auth
loginBtn.addEventListener("click", async()=>{try{await signInWithPopup(auth,provider);}catch(e){alert("ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: "+e.message)}});
logoutBtn.addEventListener("click", async()=>{await signOut(auth);});

onAuthStateChanged(auth,user=>{
  if(user){
    currentUser=user;
    loginBtn.style.display="none";
    logoutBtn.style.display="inline-block";
    userPic.src=user.photoURL||"";
    userPic.style.display=user.photoURL?"inline-block":"none";
    userNameEl.textContent=user.displayName||user.email||"Ù…Ø³ØªØ®Ø¯Ù…";
    userNameEl.style.display="inline-block";
    chatHint.textContent="Ù…Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ â€” ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹.";
  }else{
    currentUser=null;
    loginBtn.style.display="inline-block";
    logoutBtn.style.display="none";
    userPic.style.display="none";
    userNameEl.style.display="none";
    chatHint.textContent="Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ØªØ³ØªØ·ÙŠØ¹ Ø§Ù„ÙƒØªØ§Ø¨Ø©.";
  }
});

// Sites
const sitesCol = collection(db,"sites");
onSnapshot(sitesCol,snapshot=>{
  siteList.innerHTML=""; sitesShort.innerHTML="";
  snapshot.forEach(docSnap=>{
    const site=docSnap.data(); const id=docSnap.id;
    const card=document.createElement("div"); card.className="card";
    card.style.left=site.left||"0px"; card.style.top=site.top||"0px";
    card.style.width=site.width||"200px"; card.style.height=site.height||"250px";
    const img=document.createElement("img"); img.src=site.image||"https://via.placeholder.com/200x250"; img.onclick=()=>window.open(site.url,"_blank");
    const content=document.createElement("div"); content.className="card-content";
    const title=document.createElement("div"); title.textContent=site.name;
    const actions=document.createElement("div"); actions.className="actions";
    const editBtn=document.createElement("button"); editBtn.className="edit"; editBtn.textContent="âœï¸ ØªØ¹Ø¯ÙŠÙ„"; editBtn.onclick=()=>openEdit(id);
    const deleteBtn=document.createElement("button"); deleteBtn.className="delete"; deleteBtn.textContent="ğŸ—‘ Ø­Ø°Ù"; deleteBtn.onclick=()=>deleteSite(id);
    actions.appendChild(editBtn); actions.appendChild(deleteBtn);
    content.appendChild(title); content.appendChild(actions);
    const dragHandle=document.createElement("div"); dragHandle.className="drag-handle";
    const resizeHandle=document.createElement("div"); resizeHandle.className="resize-handle";
    card.appendChild(img); card.appendChild(content); card.appendChild(dragHandle); card.appendChild(resizeHandle);
    enableDragResize(card,id);
    siteList.appendChild(card);

    const short=document.createElement("div"); short.className="site-item";
    short.innerHTML=`<img src="${site.image||'https://via.placeholder.com/48x36'}"><a href="${site.url
