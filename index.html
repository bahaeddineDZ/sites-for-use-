<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>๐ ููุชุจุชู ููููุงูุน - Baha - (ุฎูููุฉ: ููู/ุตูุฑุฉ ูู Firestore + ุชุญูู ุจุงูุฎุท ูุงูุดูุงููุฉ)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
/* ... ุฌููุน CSS ุงูุณุงุจู ... */

/* Audio Section */
.audio-card{
  margin-bottom:18px;
  background:rgba(255,255,255,var(--card-opacity));
  border-radius:12px;
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
  padding:10px;
  display:flex;
  align-items:center;
  gap:18px;
}
.audio-card span{
  font-weight:bold;
  color:var(--accent);
  font-size:1.01rem;
}
.audio-card button{
  margin-left:8px;
  background:var(--danger);
  color:#fff;
  border:none;
  border-radius:8px;
  padding:6px 12px;
  cursor:pointer;
}
</style>
</head>
<body>

<header>
  <h1>๐ ููุชุจุชู ููููุงูุน - Baha -</h1>
  <div class="user-area" id="userArea">
    <img id="userPic" class="user-pic" src="" alt="" style="display:none">
    <div id="userName" class="small" style="display:none"></div>
    <button id="loginBtn" class="btn">๐ ุชุณุฌูู ุงูุฏุฎูู</button>
    <button id="logoutBtn" class="btn secondary" style="display:none">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
  </div>
</header>

<div class="layout">
  <div class="board">
    <div class="controls">
      <input id="siteName" placeholder="ุงุณู ุงููููุน">
      <input id="siteUrl" placeholder="ุฑุงุจุท ุงููููุน (https://)">
      <input id="siteImage" placeholder="ุฑุงุจุท ุตูุฑุฉ (ุงุฎุชูุงุฑู)">
      <button id="addBtn" class="add-btn">โ ุฅุถุงูุฉ</button>
      <!-- ุฅุถุงูุงุช ุงูุตูุชูุงุช -->
      <input id="audioName" placeholder="ุงุณู ุงูุตูุช">
      <input id="audioUrl" placeholder="ุฑุงุจุท ุงูุตูุช (mp3)">
      <button id="addAudioBtn" class="add-btn">๐ต ุฅุถุงูุฉ ุตูุช</button>
      <button id="changeBgBtn" class="bg-btn">๐จ ุชุบููุฑ ุงูุฎูููุฉ (ููู/ุตูุฑุฉ)</button>
      <!-- view controls: ุญุฌู ุงูุฎุท ู ุงูุดูุงููุฉ -->
      <div class="view-controls">
        <div class="control-group" style="min-width:220px;">
          <label for="fontSizeRange">ุญุฌู ุงูุฎุท</label>
          <div style="display:flex;gap:8px;align-items:center;">
            <input id="fontSizeRange" type="range" min="12" max="20" step="1" value="14">
            <div id="fontSizeValue" class="smallVal">14px</div>
          </div>
        </div>
        <div class="control-group" style="min-width:220px;">
          <label for="opacityRange">ุดูุงููุฉ ุงูุจุทุงูุงุช ูุงูููุงุฆู</label>
          <div style="display:flex;gap:8px;align-items:center;">
            <input id="opacityRange" type="range" min="0.2" max="1" step="0.05" value="1">
            <div id="opacityValue" class="smallVal">100%</div>
          </div>
          <label style="display:flex;align-items:center;gap:8px;margin-top:6px;font-size:12px;color:var(--muted)"><input id="applyToImages" type="checkbox"> ุชุทุจูู ุงูุดูุงููุฉ ุนูู ุงูุตูุฑ</label>
        </div>
        <div style="display:flex;flex-direction:column;justify-content:center;gap:6px;">
          <button id="resetView" class="btn secondary">ุฅุนุงุฏุฉ ุงูุฅุนุฏุงุฏุงุช</button>
        </div>
      </div>
    </div>
    <div id="siteList" aria-live="polite"></div>
    <!-- ูุงุฆูุฉ ุงูุตูุชูุงุช -->
    <div id="audioList" style="margin-top:24px;"></div>
  </div>
  <!-- ูุงุฆูุฉ ุงูููุงูุน -->
  <div class="list-panel" id="listPanel" style="position:absolute; left:20px; top:20px; width:320px; height:240px;">
    <div class="panel-drag-handle" title="ุงุณุญุจ">โฌ</div>
    <h3>ูุงุฆูุฉ ุงูููุงูุน</h3>
    <div class="sites-list-short" id="sitesShort"></div>
    <div class="panel-resize-handle" title="ุชุบููุฑ ุงูุญุฌู"></div>
  </div>
  <!-- ูุงูุฐุฉ ุงูุฏุฑุฏุดุฉ -->
  <div class="chat-panel" id="chatPanel" style="position:absolute; right:20px; top:260px; width:380px; height:420px;">
    <div class="panel-drag-handle" title="ุงุณุญุจ">โฌ</div>
    <h3>ุงูุฏุฑุฏุดุฉ ุงูุญูุฉ</h3>
    <div id="chatBox"></div>
    <div class="chat-controls">
      <input id="chatMessage" placeholder="ุงูุชุจ ุฑุณุงูุชู..." />
      <button type="button" onclick="toggleEmojiPanel()">๐</button>
      <button id="sendMsgBtn">๐จ</button>
    </div>
    <div id="emojiPanel" class="emoji-panel"></div>
    <div id="chatHint" class="small">ุณุฌูู ุงูุฏุฎูู ูุชุณุชุทูุน ุงููุชุงุจุฉ.</div>
    <div class="panel-resize-handle" title="ุชุบููุฑ ุงูุญุฌู"></div>
  </div>
</div>

<footer style="padding:10px;text-align:center;color:var(--muted);font-size:13px;">ยฉ ููุชุจุชู ููููุงูุน โ BBE</footer>

<script type="module">
// ... ุฌููุน ุงูููุฏ ุงูุณุงุจู ...
// ----------------------------
// ุนูุงุตุฑ ุงูุตูุชูุงุช
const addAudioBtn = document.getElementById("addAudioBtn");
const audioNameInput = document.getElementById("audioName");
const audioUrlInput = document.getElementById("audioUrl");
const audioList = document.getElementById("audioList");

// ----------------------------
// Audio player handling (Firestore)
// ----------------------------
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, doc, setDoc, updateDoc, deleteDoc, onSnapshot, query, orderBy, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

// ... ุฅุนุฏุงุฏ Firebase ูุงูู DOM ูุงูููุฏ ุงูุณุงุจู ...

// ูุฌููุนุฉ ุงูุตูุชูุงุช ุงูุฌุฏูุฏุฉ
const audiosCol = collection(db,"audios");

onSnapshot(audiosCol, snapshot => {
  audioList.innerHTML = '<h3 style="margin-bottom:10px">๐ต ูุงุฆูุฉ ุงูุตูุชูุงุช</h3>';
  snapshot.forEach(docSnap => {
    const audio = docSnap.data();
    const id = docSnap.id;
    const div = document.createElement("div");
    div.className = "audio-card";
    const name = document.createElement("span");
    name.textContent = audio.name || "ุจุฏูู ุงุณู";
    // ูุดุบู ุงูุตูุชูุงุช
    const player = document.createElement("audio");
    player.controls = true;
    player.src = audio.url;
    player.style = "width:180px;";
    // ุฒุฑ ุญุฐู
    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "๐ ุญุฐู";
    deleteBtn.className = "btn secondary";
    deleteBtn.onclick = () => deleteDoc(doc(db, "audios", id));
    div.appendChild(name);
    div.appendChild(player);
    div.appendChild(deleteBtn);
    audioList.appendChild(div);
  });
});

addAudioBtn.addEventListener("click", async () => {
  if(!currentUser){ alert("ุณุฌูู ุงูุฏุฎูู ุฃููุงู"); return; }
  const name = audioNameInput.value.trim();
  const url = audioUrlInput.value.trim();
  if(!name || !url){ alert("ุงููุฃ ุงุณู ุงูุตูุช ูุงูุฑุงุจุท"); return; }
  // ุฏุนู mp3/wav/ogg ููุท
  if(!/^https?:\/\/.+\.(mp3|wav|ogg)$/i.test(url)){ alert("ูุฑุฌู ูุถุน ุฑุงุจุท ุตูุช ูุจุงุดุฑ (mp3 ุฃู wav ุฃู ogg)"); return; }
  await addDoc(audiosCol, { name, url });
  audioNameInput.value = ""; audioUrlInput.value = "";
});

// ... ุจุงูู ุงูููุฏ ููุง ูู (ุงูููุงูุน ูุงูุฏุฑุฏุดุฉ ูููุญุงุช ุงูุชุญูู)
// ูู ุชุชุฃุซุฑ ุฃู ูุธููุฉ ุญุงููุฉุ ูู ูุง ุนููู ูู ูุณุฎ ูุฐุง ุงูููู ููุนูู ูุจุงุดุฑุฉ.
</script>
</body>
</html>
